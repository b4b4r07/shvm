#!/usr/bin/env bash

fetch() {
  if [[ -d "$BASHVM_HOME/src/bash-${1}" ]]; then
    echo "The source of bash-${1} is already exists"
    return 0
  fi

  tmpfile=$(mktemp)
  echo "Fetching bash-${1}..."
  curl -o"$tmpfile"  --progress-bar "ftp://ftp.gnu.org/gnu/bash/bash-${1}.tar.gz" || exit 1
  tar zxf "$tmpfile" -C $BASHVM_HOME/src
  rm "$tmpfile"
}

help() {
  echo -n "\
Usage: bashvm fetch <version>
"
}

case "$1" in
--help)
  shift
  help
  ;;
-*|--*)
  die "Unrecognized option: $1"
  ;;
*)
  fetch ${1#bash-}
  ;;
esac
